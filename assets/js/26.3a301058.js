(window.webpackJsonp=window.webpackJsonp||[]).push([[26],{588:function(e,s,a){"use strict";a.r(s);var t=a(14),l=Object(t.a)({},(function(){var e=this,s=e.$createElement,a=e._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h2",{attrs:{id:"_1-什么是controller"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-什么是controller"}},[e._v("#")]),e._v(" 1. 什么是controller")]),e._v(" "),a("ul",[a("li",[e._v("在集群上管理和运行容器的对象")]),e._v(" "),a("li",[e._v("controller的几种类型\n"),a("ul",[a("li",[e._v("Deployment : 部署无状态应用")]),e._v(" "),a("li",[e._v("SatefulSet : 部署有状态应用")]),e._v(" "),a("li",[e._v("DaemonSet  : 部署守护进程")]),e._v(" "),a("li",[e._v("Job : 一次性任务")]),e._v(" "),a("li",[e._v("cronJob : 定时任务")])])])]),e._v(" "),a("h2",{attrs:{id:"_2-pod和controller之间的关系"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-pod和controller之间的关系"}},[e._v("#")]),e._v(" 2.pod和controller之间的关系")]),e._v(" "),a("ul",[a("li",[e._v("pod是通过Controller实现应用的运维（弹性伸缩、滚动升级）")]),e._v(" "),a("li",[e._v("pod通过打标签来和controller建立关系")])]),e._v(" "),a("p",[a("img",{attrs:{src:"https://www.rishiqing.com/task/v1/folder/file/url?signature=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ0eXBlIjoidmlldyIsImlhdCI6MTY0OTc2OTU0OSwiZmlsZUlkIjo2MjU0MzM0LCJ0aW1lc3RhbXAiOjE2NDk3Njk1NDk3NzV9.ipY36_zKGI1zrHl8v-vne2H1fRGcUVzNf3a9VkgOMX8",alt:"图示"}})]),e._v(" "),a("h2",{attrs:{id:"_3-deployment控制器应用场景"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-deployment控制器应用场景"}},[e._v("#")]),e._v(" 3.Deployment控制器应用场景")]),e._v(" "),a("ul",[a("li",[e._v("部署无状态应用")]),e._v(" "),a("li",[e._v("管理Pod和ReplicasSet（副本）")]),e._v(" "),a("li",[e._v("部署、滚动升级...\n应用场景：web服务、微服务")])]),e._v(" "),a("blockquote",[a("p",[e._v("用命令行创建的只用于学习和测试，一般还是用yaml文件来声明式创建")])]),e._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("kubectl create deployment web --image"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("nginx\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("h2",{attrs:{id:"_4-yaml文件字段说明"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-yaml文件字段说明"}},[e._v("#")]),e._v(" 4.yaml文件字段说明")]),e._v(" "),a("p",[a("img",{attrs:{src:"https://www.rishiqing.com/task/v1/folder/file/url?signature=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ0eXBlIjoidmlldyIsImlhdCI6MTY0OTc3MDU0MiwiZmlsZUlkIjo2MjU0NDExLCJ0aW1lc3RhbXAiOjE2NDk3NzA1NDI1Mzh9.RfYOTHDH9p6CM2B7iTzY6DxNtyc9Ly8FdBSNaUyxHk0",alt:"图示"}})]),e._v(" "),a("h2",{attrs:{id:"_5-deployment控制器部署应用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-deployment控制器部署应用"}},[e._v("#")]),e._v(" 5.Deployment控制器部署应用")]),e._v(" "),a("ol",[a("li",[e._v("生成一个pod的yaml文件")])]),e._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("kubectl create deployment web --image"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("nginx --dry-run -o yaml "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" web.yaml\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("ol",{attrs:{start:"2"}},[a("li",[e._v("部署一个pod")])]),e._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("kubectl apply -f web.yaml\n\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br")])]),a("ol",{attrs:{start:"3"}},[a("li",[e._v("对外发布（暴露端口号）")])]),e._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("kubctl expse deployment web --port"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("80")]),e._v("  --type"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("nodePort --target-port"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("80")]),e._v(" --name"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("web-demo -o\n-o yaml "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" web1.yaml\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br")])]),a("h2",{attrs:{id:"_6-升级回滚"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-升级回滚"}},[e._v("#")]),e._v(" 6.升级回滚")]),e._v(" "),a("ul",[a("li",[e._v("eg: 升级一个Nginx应用的Nginx镜像版本")])]),e._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("kuebctl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("set")]),e._v(" image deployment web "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("nginx")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("nginx:1.1.7\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("blockquote",[a("p",[e._v("除了用命令，也可以直接改yaml文件中的镜像版本和副本数量")])]),e._v(" "),a("blockquote",[a("p",[e._v("并且升级过程中pod的应用服务不会中断，因为下载新的之后并且启动了容器才会替换之前的旧副本应用")])]),e._v(" "),a("ul",[a("li",[e._v("查看deployment的升级状态")])]),e._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("kubectl rollout status deployment web\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("ul",[a("li",[e._v("回滚(rollout)\n查看历史版本")])]),e._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("kubectl rollout  "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("history")]),e._v(" deployment web\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("h2",{attrs:{id:"_7-弹性伸缩"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-弹性伸缩"}},[e._v("#")]),e._v(" 7.弹性伸缩")]),e._v(" "),a("ul",[a("li",[e._v("replicas(副本)")])]),e._v(" "),a("p",[a("img",{attrs:{src:"https://www.rishiqing.com/task/v1/folder/file/url?signature=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ0eXBlIjoidmlldyIsImlhdCI6MTY0OTc3MTY1NiwiZmlsZUlkIjo2MjU0NDY3LCJ0aW1lc3RhbXAiOjE2NDk3NzE2NTYwMDF9.E2Y9Nz6nmmlUfSx8UprVhqj2euoH95jyvwbwQ50_QWw",alt:"图示"}})]),e._v(" "),a("ul",[a("li",[e._v("也可以 kubectl scale 命令 来进行deployment中pod的容器副本")])]),e._v(" "),a("p",[a("img",{attrs:{src:"https://www.rishiqing.com/task/v1/folder/file/url?signature=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ0eXBlIjoidmlldyIsImlhdCI6MTY0OTc3MjYzMiwiZmlsZUlkIjo2MjU0NTE5LCJ0aW1lc3RhbXAiOjE2NDk3NzI2MzI4MDB9.ZnL2ywe7pXU4f2GwEJU6a7gmfX0BeqUHKzKwAX7XDQ0",alt:"图示"}})]),e._v(" "),a("h2",{attrs:{id:"_8-无状态和有状态应用的区别"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_8-无状态和有状态应用的区别"}},[e._v("#")]),e._v(" 8.无状态和有状态应用的区别")]),e._v(" "),a("ul",[a("li",[e._v("无状态 可用deployment来部署\n"),a("ul",[a("li",[e._v("可以认为pod都是一样的")]),e._v(" "),a("li",[e._v("没有顺序要求")]),e._v(" "),a("li",[e._v("不用考虑在哪个node运行")]),e._v(" "),a("li",[e._v("随意进行伸缩和扩展")])])]),e._v(" "),a("li",[e._v("有状态\n"),a("ul",[a("li",[a("p",[e._v("上面无状态的因素都需要考虑")])]),e._v(" "),a("li",[a("p",[e._v("让每个pod独立，保持pod启动顺序和唯一性")]),e._v(" "),a("ul",[a("li",[e._v("唯一的网络标识符，数据持久存储")]),e._v(" "),a("li",[e._v("有序，比如mysql的主从")])])]),e._v(" "),a("li",[a("p",[e._v("如何部署有状态应用")]),e._v(" "),a("ul",[a("li",[e._v("需要有一个无头 service （即一个service的 ClusterIp : none）")]),e._v(" "),a("li",[e._v("通过 SatefulSet 来部署")])]),e._v(" "),a("p",[a("img",{attrs:{src:"https://www.rishiqing.com/task/v1/folder/file/url?signature=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ0eXBlIjoidmlldyIsImlhdCI6MTY0OTgyMzY5MiwiZmlsZUlkIjo2MjU2NjAwLCJ0aW1lc3RhbXAiOjE2NDk4MjM2OTI3NTZ9.17Qd5IfQKDmAzy6t-2ooCCmpOMNZ09i1JiMNiqSIzoM",alt:"图例"}})]),e._v(" "),a("p",[a("img",{attrs:{src:"https://www.rishiqing.com/task/v1/folder/file/url?signature=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpYXQiOjE2NjAzMTIyNTMsImZpbGVJZCI6NjI1NjYxNCwidGltZXN0YW1wIjoxNjYwMzEyMjUzNTk4fQ.vYTFLM560lvbOzY3jm-FMHGamddLBEY_Vy4rI9ab61c",alt:"图例"}})])])])])]),e._v(" "),a("h2",{attrs:{id:"_9-daemonset"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_9-daemonset"}},[e._v("#")]),e._v(" 9.DaemonSet")]),e._v(" "),a("p",[a("img",{attrs:{src:"https://www.rishiqing.com/task/v1/folder/file/url?signature=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ0eXBlIjoidmlldyIsImlhdCI6MTY0OTgyNDU5MiwiZmlsZUlkIjo2MjU2NjI0LCJ0aW1lc3RhbXAiOjE2NDk4MjQ1OTIxODd9.6BNE3JxqiFnwELl3Bc-nC8jiB0LsbI7e2pWWsMaorGM",alt:"图示"}})]),e._v(" "),a("p",[a("img",{attrs:{src:"https://www.rishiqing.com/task/v1/folder/file/url?signature=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ0eXBlIjoidmlldyIsImlhdCI6MTY0OTgyNDc2MiwiZmlsZUlkIjo2MjU2NjMyLCJ0aW1lc3RhbXAiOjE2NDk4MjQ3NjIzMTJ9.JN6w-eJVIGegN2vjRwwSiQb6MFpKxndLzuIsuSz8PZ4",alt:"图示"}})]),e._v(" "),a("h2",{attrs:{id:"_10-job"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_10-job"}},[e._v("#")]),e._v(" 10. Job")]),e._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("kubectl get "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("jobs")]),e._v("\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://www.rishiqing.com/task/v1/folder/file/url?signature=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ0eXBlIjoidmlldyIsImlhdCI6MTY0OTg1NDgxMywiZmlsZUlkIjo2MjYxMTA0LCJ0aW1lc3RhbXAiOjE2NDk4NTQ4MTM4NTZ9.6cBeAA0Ad6CgOqYxFdSspV7BOyWPM3KL6pKVeUsebyg",alt:"图示"}})]),e._v(" "),a("blockquote",[a("p",[e._v("backoffLimit: 重启策略 4次")])]),e._v(" "),a("h2",{attrs:{id:"_11-cronjob"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_11-cronjob"}},[e._v("#")]),e._v(" 11.CronJob")]),e._v(" "),a("p",[a("img",{attrs:{src:"https://www.rishiqing.com/task/v1/folder/file/url?signature=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ0eXBlIjoidmlldyIsImlhdCI6MTY0OTg1NTYyMywiZmlsZUlkIjo2MjYxMTU2LCJ0aW1lc3RhbXAiOjE2NDk4NTU2MjMwOTh9.zU9DVeOQE_3tSyhPmH6fyp9RQXaKHcXmPzJtCIlbpDk",alt:"图示"}})])])}),[],!1,null,null,null);s.default=l.exports}}]);