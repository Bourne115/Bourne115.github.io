(window.webpackJsonp=window.webpackJsonp||[]).push([[25],{583:function(i,s,l){"use strict";l.r(s);var e=l(14),t=Object(e.a)({},(function(){var i=this,s=i.$createElement,l=i._self._c||s;return l("ContentSlotsDistributor",{attrs:{"slot-key":i.$parent.slotKey}},[l("h2",{attrs:{id:"_1-pod的基本概念"}},[l("a",{staticClass:"header-anchor",attrs:{href:"#_1-pod的基本概念"}},[i._v("#")]),i._v(" 1.pod的基本概念")]),i._v(" "),l("ul",[l("li",[i._v("pod是一个抽象容器运行环境的概念")]),i._v(" "),l("li",[i._v("k8s集群中的最小部署单元")]),i._v(" "),l("li",[i._v("pod是由一个或多个container的集合")]),i._v(" "),l("li",[i._v("一个pod中的容器共享网络命名空间")]),i._v(" "),l("li",[i._v("pod是短暂的")]),i._v(" "),l("li",[i._v('每个pod都有一个特殊的被称为"根容器"的'),l("code",[i._v("Pause容器")]),i._v("，"),l("code",[i._v("Pause容器")]),i._v("对应的镜像属于 "),l("code",[i._v("kubernetes")]),i._v("平台的一部分，除了根容器，每个Pod还包含一个或多个紧密相关的用户业务容器")])]),i._v(" "),l("p",[l("img",{attrs:{src:"https://www.rishiqing.com/task/v1/folder/file/url?signature=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ0eXBlIjoidmlldyIsImlhdCI6MTY0OTUwMjU5NCwiZmlsZUlkIjo2MjM4NDMxLCJ0aW1lc3RhbXAiOjE2NDk1MDI1OTQ0NDd9.37bV01Ctpn4AIp8HnNvr0v9Xz4sv4VvssI_L12uDQnY",alt:"pod的基本概念"}})]),i._v(" "),l("h2",{attrs:{id:"_2-pod存在的意义"}},[l("a",{staticClass:"header-anchor",attrs:{href:"#_2-pod存在的意义"}},[i._v("#")]),i._v(" 2.pod存在的意义")]),i._v(" "),l("ol",[l("li",[i._v('首先容器的"单进程模型"，并不是指容器里只能运行"一个"进程，而是指容器没有管理多个进程的能力。这是因为容器里的主进程（PID=1 的进程）就是应用本身，其他的进程都是这个主进程的子进程。可是，用户编写的应用，并不能够像正常操作系统里的init进程或者systemd 那样拥有进程管理的功能。比如，你的容器启动命令是执行一个shell脚本，脚本里依次启动容器里的Nginx和Web应用。')])]),i._v(" "),l("ul",[l("li",[i._v("比如是下面这个shell脚本：")])]),i._v(" "),l("div",{staticClass:"language-shell line-numbers-mode"},[l("pre",{pre:!0,attrs:{class:"language-shell"}},[l("code",[l("span",{pre:!0,attrs:{class:"token function"}},[i._v("sudo")]),i._v(" "),l("span",{pre:!0,attrs:{class:"token function"}},[i._v("su")]),i._v(" -root -c "),l("span",{pre:!0,attrs:{class:"token string"}},[i._v('"nginx -s start && /app/go_web_bin"')]),i._v("\n")])]),i._v(" "),l("div",{staticClass:"line-numbers-wrapper"},[l("span",{staticClass:"line-number"},[i._v("1")]),l("br")])]),l("blockquote",[l("p",[i._v("那么这个容器里主进程是sh，Nginx和Web应用是子进程。可是，当这个 Nginx进程异常退出的时候，主进程sh是感知不到的，也就没法对Nginx进行重启。Docker只能识别主进程的状态，如果主进程正常，Docker的状态就是Running所以在容器里不推荐跑多个进程。所以更确切的说法是每个容器应该只有一个关注点，只有一个单一的功能。将应用程序解耦到多个容器中，可以更轻松地水平缩扩和重复使用容器。例如，一个Web应用程序服务可能由三个单独的容器组成，每个容器都有自己的镜像，以松耦合的方式管理Web应用程序，数据库和Redis缓存。对于这些相互依赖的容器，则使用Docker容器网络来保持这些容器的通信。")])]),i._v(" "),l("ol",{attrs:{start:"2"}},[l("li",[i._v("pod是“多进程模式”设计，可运行多个应用程序")])]),i._v(" "),l("ul",[l("li",[i._v("一个pod有多个容器，一个容器里面运行一个应用程序")])]),i._v(" "),l("ol",{attrs:{start:"3"}},[l("li",[i._v("pod存在是为了亲密性应用")])]),i._v(" "),l("ul",[l("li",[i._v("两个应用之间进行交互")]),i._v(" "),l("li",[i._v("网络之前的调用")]),i._v(" "),l("li",[i._v("两个应用需要频繁调用")])]),i._v(" "),l("div",{staticClass:"custom-block warning"},[l("p",{staticClass:"title"}),l("p",[i._v("除了 "),l("code",[i._v("Docker")]),i._v(" 之外，"),l("code",[i._v("Kubernetes")]),i._v(" 支持 很多其他容器运行时， "),l("code",[i._v("Docker")]),i._v(" 是最有名的运行时。\n使用 "),l("code",[i._v("Docker")]),i._v(" 的术语来描述 "),l("code",[i._v("Pod")]),i._v(" 会比较好理解")])]),l("h2",{attrs:{id:"_3-pod实现机制"}},[l("a",{staticClass:"header-anchor",attrs:{href:"#_3-pod实现机制"}},[i._v("#")]),i._v(" 3.Pod实现机制")]),i._v(" "),l("h3",{attrs:{id:"_3-1共享网络"}},[l("a",{staticClass:"header-anchor",attrs:{href:"#_3-1共享网络"}},[i._v("#")]),i._v(" 3.1共享网络")]),i._v(" "),l("ul",[l("li",[i._v("容器本身之间是相互隔离的（namespace CGroup 来实现的）")]),i._v(" "),l("li",[i._v("前提条件---- 让容器在同一个 ns 中")]),i._v(" "),l("li",[i._v("pod如何实现共享网络机制\n"),l("ul",[l("li",[i._v("首先创建 pause 容器 也可以叫 info容器")]),i._v(" "),l("li",[i._v("在info容器中会独立出 ip mac port")]),i._v(" "),l("li",[i._v("创建业务容器时会把业务容器加入到info容器中，")])])])]),i._v(" "),l("p",[l("img",{attrs:{src:"https://www.rishiqing.com/task/v1/folder/file/url?signature=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ0eXBlIjoidmlldyIsImlhdCI6MTY0OTUwNTA3NSwiZmlsZUlkIjo2MjM4NDc3LCJ0aW1lc3RhbXAiOjE2NDk1MDUwNzU4MzF9.N3TEAyjOU5a9bO624YVP9NJZ7_p7_8znSB0sn4hrC6o",alt:"图示"}})]),i._v(" "),l("h3",{attrs:{id:"_3-2共享存储"}},[l("a",{staticClass:"header-anchor",attrs:{href:"#_3-2共享存储"}},[i._v("#")]),i._v(" 3.2共享存储")]),i._v(" "),l("ul",[l("li",[l("p",[i._v("需要了解一个 volumes: 挂载（数据）卷的概念")])]),i._v(" "),l("li",[l("p",[i._v("pod持久化数据")]),i._v(" "),l("ul",[l("li",[i._v("日志数据")]),i._v(" "),l("li",[i._v("业务数据")])])]),i._v(" "),l("li",[l("p",[i._v("使用数据卷进行持久化数据存储\n"),l("img",{attrs:{src:"https://www.rishiqing.com/task/v1/folder/file/url?signature=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ0eXBlIjoidmlldyIsImlhdCI6MTY0OTU5NzQ2MywiZmlsZUlkIjo2MjQxMTM5LCJ0aW1lc3RhbXAiOjE2NDk1OTc0NjMyOTB9.XLL4O91GJ8h-5trrJpezaCKdUKbJB5zh5P80wE7zf54",alt:"图示"}})])]),i._v(" "),l("li",[l("p",[i._v("pod重启机制\n"),l("img",{attrs:{src:"https://www.rishiqing.com/task/v1/folder/file/url?signature=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ0eXBlIjoidmlldyIsImlhdCI6MTY0OTU5NzUyMiwiZmlsZUlkIjo2MjQxMTQwLCJ0aW1lc3RhbXAiOjE2NDk1OTc1MjIxOTZ9.4je3KX8PsceotDo4MK2z5B1yaqnz1DgvsLiLZ-afW_w",alt:"图示"}})])])]),i._v(" "),l("h2",{attrs:{id:"_4-pod健康检测-probe-探针"}},[l("a",{staticClass:"header-anchor",attrs:{href:"#_4-pod健康检测-probe-探针"}},[i._v("#")]),i._v(" 4.pod健康检测 probe（探针）")]),i._v(" "),l("p",[l("img",{attrs:{src:"https://www.rishiqing.com/task/v1/folder/file/url?signature=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ0eXBlIjoidmlldyIsImlhdCI6MTY0OTU5ODI0OCwiZmlsZUlkIjo2MjQxMTU4LCJ0aW1lc3RhbXAiOjE2NDk1OTgyNDg0ODN9.hlmTZ_yxtCfy_kiy1CWg6vo7zHlL8tYv5iGBCInVgUA",alt:"图示"}})]),i._v(" "),l("h2",{attrs:{id:"_5-pod调度策略"}},[l("a",{staticClass:"header-anchor",attrs:{href:"#_5-pod调度策略"}},[i._v("#")]),i._v(" 5.pod调度策略")]),i._v(" "),l("p",[l("img",{attrs:{src:"https://www.rishiqing.com/task/v1/folder/file/url?signature=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ0eXBlIjoidmlldyIsImlhdCI6MTY0OTU5OTM4MywiZmlsZUlkIjo2MjQxMTkxLCJ0aW1lc3RhbXAiOjE2NDk1OTkzODMzNzB9.9dPPqMquk3g0JyBuLYPZWuVu3weVhws_LgpSuSvkR7s",alt:"图示"}})]),i._v(" "),l("div",{staticClass:"language-bash line-numbers-mode"},[l("pre",{pre:!0,attrs:{class:"language-bash"}},[l("code",[i._v("kubectl create -f  xxx.yaml\n\nkubectl apply  -f xxx.yaml\n")])]),i._v(" "),l("div",{staticClass:"line-numbers-wrapper"},[l("span",{staticClass:"line-number"},[i._v("1")]),l("br"),l("span",{staticClass:"line-number"},[i._v("2")]),l("br"),l("span",{staticClass:"line-number"},[i._v("3")]),l("br")])]),l("blockquote",[l("p",[i._v("create是创建新的pod，并且相同yaml只能执行一次。\napply也是创建，但它的创建是有就更新，没有就新建，可以多次执行")])]),i._v(" "),l("h2",{attrs:{id:"_6-资源限制对调度的影响"}},[l("a",{staticClass:"header-anchor",attrs:{href:"#_6-资源限制对调度的影响"}},[i._v("#")]),i._v(" 6.资源限制对调度的影响")]),i._v(" "),l("ul",[l("li",[i._v("pod资源限制对pod调度产生影响")])]),i._v(" "),l("p",[l("img",{attrs:{src:"https://www.rishiqing.com/task/v1/folder/file/url?signature=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ0eXBlIjoidmlldyIsImlhdCI6MTY0OTU5OTQ4MSwiZmlsZUlkIjo2MjQxMTkyLCJ0aW1lc3RhbXAiOjE2NDk1OTk0ODE4NTl9.8miFWviQfuboAdSFdCKC3kuUHGqICJqAnLwr55lPbhQ",alt:"图示"}})]),i._v(" "),l("ul",[l("li",[i._v("节点选择器 标签影响pod调度")])]),i._v(" "),l("blockquote",[l("p",[i._v("nodeSelector")])]),i._v(" "),l("div",{staticClass:"language-bash line-numbers-mode"},[l("pre",{pre:!0,attrs:{class:"language-bash"}},[l("code",[i._v("kubectl  label "),l("span",{pre:!0,attrs:{class:"token function"}},[i._v("node")]),i._v(" nodeName  env-role"),l("span",{pre:!0,attrs:{class:"token operator"}},[i._v("=")]),i._v("prod\n")])]),i._v(" "),l("div",{staticClass:"line-numbers-wrapper"},[l("span",{staticClass:"line-number"},[i._v("1")]),l("br")])]),l("p",[l("img",{attrs:{src:"https://www.rishiqing.com/task/v1/folder/file/url?signature=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpYXQiOjE2NjAzMTA4ODcsImZpbGVJZCI6NjI0MTE5OCwidGltZXN0YW1wIjoxNjYwMzEwODg3MTQyfQ.nPewNd02NJjad6jGmeVWn20_moozehopRLkQUlN_eyg",alt:"图示"}})]),i._v(" "),l("ul",[l("li",[i._v("节点亲和性，nodeAffinity 对pod调度的影响")])]),i._v(" "),l("p",[l("img",{attrs:{src:"https://www.rishiqing.com/task/v1/folder/file/url?signature=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ0eXBlIjoidmlldyIsImlhdCI6MTY0OTYwMDYyOCwiZmlsZUlkIjo2MjQxMjMzLCJ0aW1lc3RhbXAiOjE2NDk2MDA2MjgyMDF9.1V91ZXAT6KAPoFUtnB_kbJfojpdckd-9LnF_JV3Tx7c",alt:"图示"}})]),i._v(" "),l("ul",[l("li",[i._v("反亲和性")])]),i._v(" "),l("blockquote",[l("p",[i._v("可以用操作符 NotIn  DoesNotExists 来实现，与亲和性相反")])]),i._v(" "),l("ul",[l("li",[i._v("污点和污点容忍 "),l("code",[i._v("taint")])])]),i._v(" "),l("p",[l("img",{attrs:{src:"https://www.rishiqing.com/task/v1/folder/file/url?signature=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ0eXBlIjoidmlldyIsImlhdCI6MTY0OTY1MTQwMCwiZmlsZUlkIjo2MjQzNzMzLCJ0aW1lc3RhbXAiOjE2NDk2NTE0MDA3NjF9.9C1V2vnvt0We_FPk-vW8XpjPyaxI3lQg8-W7iv9zpqI",alt:"图示"}})])])}),[],!1,null,null,null);s.default=t.exports}}]);